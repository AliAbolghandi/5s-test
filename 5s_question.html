<!DOCTYPE html>
<html lang="fa">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- <link rel="stylesheet" href="https://cdn.fontcdn.ir/Font/Yekan/Yekan.css"> -->
  <link rel="stylesheet" href="./library/font/yekan/yekan.css">

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4361ee">

  <!-- Ø¨Ø±Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø¯Ø± iOS -->
  <link rel="apple-touch-icon" href="./img/icon-512.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">


  <title>Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ 5S Ù…Ø¬ØªÙ…Ø¹ ÙÙˆÙ„Ø§Ø¯ Ø±ÙˆÙ‡ÛŒÙ†Ø§ Ø¬Ù†ÙˆØ¨</title>
  <style>
    :root {
      --primary: #4361ee;
      --primary-dark: #3a56d4;
      --primary-verydark: #182a7a;
      --secondary: #7209b7;
      --success: #06d6a0;
      --success2: #06d6ba;
      --danger: #ef476f;
      --warning: #ffd166;
      --light: #f8f9fa;
      --dark: #212529;
      --gray: #6c757d;
      --lock: #bf2424;
      --border-radius: 12px;
      --box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Yekan', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      margin: 0;
      display: flex;
      flex-wrap: wrap;
      min-height: 100vh;
    }

    /* Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ - Ú†ÛŒÙ†Ø´ Ø±Ø¯ÛŒÙÛŒ Ø¯Ø± ØªÙ…Ø§Ù… Ø³Ø§ÛŒØ²Ù‡Ø§ */
    #dashboard {
      width: 100%;
      height: 20vh;
      border-radius: 0 0 10px 10px;
      background: var(--primary);
      color: white;
      padding: 20px 30px;
      box-sizing: border-box;
      display: flex;
      flex-direction: row-reverse;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--box-shadow);
      flex-wrap: nowrap;
      text-align: center;
      /* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø´Ú©Ø³ØªÙ† Ø®Ø· */
    }

    /* Ø¯Ú©Ù…Ù‡ Ø®Ø±ÙˆØ¬ */
    #logoutBtn.btn-logout {
      font-family: 'Yekan', sans-serif;
      background: var(--danger);
      color: white;
      border: none;
      padding: 8px 16px;
      font-size: 10px;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: 20px;
      white-space: nowrap;
      /* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø´Ú©Ø³ØªÙ† Ù…ØªÙ† */
    }

    #logoutBtn.btn-logout:hover {
      background: #d32f2f;
      transform: translateY(-2px);
    }

    #dashboard h2 {
      margin: 0;
      font-size: 22px;
      position: relative;
      padding-bottom: 0;
      text-align: center;
      flex-grow: 1;
    }

    #dashboard h2::after {
      display: none;
      /* Ø­Ø°Ù Ø®Ø· Ø²ÛŒØ± Ø¹Ù†ÙˆØ§Ù† Ø¯Ø± Ø­Ø§Ù„Øª Ø±Ø¯ÛŒÙÛŒ */
    }

    #dashboard .avatar {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-left: 20px;
    }

    #dashboard .avatar img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 3px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #dashboard .user-info {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-left: 15px;
    }

    #dashboard .username {
      font-size: 16px;
      font-weight: bold;
      margin: 0 0 5px 0;
    }

    #dashboard .phone {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.8);
    }

    /* Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ */
    #main {
      flex: 1;
      padding: 20px;
      min-width: 300px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }

    #main h2 {
      text-align: center;
      margin-bottom: 25px;
      color: var(--dark);
      font-weight: 700;
      position: relative;
      padding-bottom: 15px;
      width: 100%;
    }

    #main h2::after {
      content: '';
      position: absolute;
      bottom: 0;
      right: 50%;
      transform: translateX(50%);
      width: 100%;
      height: 3px;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      border-radius: 3px;
    }

    /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
    .btn {
      font-family: 'Yekan', sans-serif;
      margin: 8px;
      padding: 12px 16px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      flex: 1;
      min-width: 120px;
      max-width: 200px;
      text-align: center;
      transition: var(--transition);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      font-size: 14px;
    }

    .btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .btn.active {
      background: var(--success);
    }

    .btn.disabled {
      background: var(--gray);
      cursor: pointer;
      opacity: 0.5;
    }

    .btn.locked {
      background: var(--lock) !important;
      color: #999 !important;
      cursor: not-allowed !important;
      opacity: 0.6 !important;
      position: relative;
    }

    .btn.locked::after {
      content: "ğŸ”’";
      position: absolute;
      left: 8px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 12px;
    }

    .btn-danger {
      background: var(--danger);
    }

    .btn-danger:hover {
      background: #d32f2f;
    }

    #factory-container,
    #area-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 20px;
      width: 100%;
    }

    .divider {
      width: 80%;
      margin: 20px auto;
      border: 0;
      height: 3px;
      border-radius: var(--border-radius);
      background: linear-gradient(to right, var(--primary), var(--secondary));
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .question {
      margin: 15px 0;
      padding: 15px;
      border: 1px solid #e2e8f0;
      border-radius: var(--border-radius);
      background: white;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      width: 100%;
      text-align: right;
      direction: rtl;
      transition: var(--transition);
    }

    .question p {
      margin: 0 0 10px 0;
      font-weight: 500;
      color: var(--dark);
      direction: rtl;
      unicode-bidi: plaintext;
    }

    .question:hover {
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-2px);
    }

    input[type="number"] {
      width: 70px;
      padding: 10px;
      font-size: 16px;
      text-align: center;
      border: 1px solid #717579;
      border-radius: var(--border-radius);
      transition: var(--transition);
      direction: ltr;
    }

    input[type="number"]:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
      outline: none;
    }

    #result {
      margin-top: 25px;
      font-weight: bold;
      font-size: 18px;
      text-align: center;
      padding: 15px;
      background: var(--light);
      border-radius: var(--border-radius);
      width: 100%;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
    }

    #questions-container {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #questions-container>h3 {
      text-align: center;
      margin-bottom: 20px;
      color: var(--dark);
      width: 100%;
    }



    /* Ù„ÙˆØ¯ÛŒÙ†Ú¯ */
    .loading {
      display: none;
      margin: 15px auto;
      text-align: center;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }

    .score-options {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }

    .score-btn {
      font-family: 'Yekan', sans-serif;
      padding: 6px 12px;
      border: 1px solid var(--primary);
      background: white;
      color: var(--primary);
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
    }

    .score-btn:hover {
      background: var(--primary-dark);
      color: white;
    }

    .score-btn.selected {
      background: var(--success);
      color: white;
      border-color: var(--success);
    }

    .desc-box {
      width: 100%;
      min-height: 60px;
      resize: none;
      margin-top: 10px;
      padding: 10px;
      font-family: 'Yekan', sans-serif;
      font-size: 12px;
      border: 1px solid #888888;
      border-radius: var(--border-radius);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      transition: var(--transition);
    }

    .desc-box:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
      outline: none;
    }


    .modal {
      padding-top: 200px;
      display: none;
      position: fixed;
      inset: 0;
      z-index: 999;
      background-color: rgba(0, 0, 0, 0.5);

    }

    .modal-content {
      background: #fff;
      margin: 15% auto;
      padding: 20px 30px;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      font-family: 'Yekan', sans-serif;
      font-size: 14px;
    }

    .close-btn {
      margin-top: 15px;
      padding: 8px 16px;
      background-color: #1976d2;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-family: 'Yekan', sans-serif;
    }

    .close-btn:hover {
      background-color: #1565c0;
    }

    .user-info .survey-end-date {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      margin-top: 10px;
      padding: 8px 14px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 10px;
      color: #fff;
      font-family: 'Yekan', sans-serif;
      font-size: 12px;
      font-weight: 500;
      backdrop-filter: blur(8px);
      transition: background 0.3s ease, transform 0.2s ease;
    }



    .user-info .survey-end-date .label {
      color: #ffe680;
      font-weight: 600;
    }

    .user-info .survey-end-date .value {
      color: #ffffff;
      font-family: 'Yekan', sans-serif;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 1px;
    }

    .menu-btn {
      font-size: 30px;
      cursor: pointer;
      padding: 10px;
      color: white;
      z-index: 1100;
      position: relative;
    }

    .side-menu {
      height: 100%;
      width: 0;
      position: fixed;
      top: 0;
      left: 0;
      backdrop-filter: blur(12px);
      background: rgba(55, 4, 138, 0.15);
      box-shadow: 2px 0 15px rgba(2, 0, 0, 0.3);
      border-right: 1px solid rgba(49, 8, 233, 0.3);
      overflow-x: hidden;
      transition: 0.3s;
      padding-top: 60px;
      direction: rtl;
      z-index: 1000;
    }

    .side-menu a {
      padding: 12px 25px;
      background-color: rgba(114, 73, 179, 0.15);
      border-radius: 20px;
      text-decoration: none;
      color: #010002;
      display: block;
      transition: 0.2s;
      font-size: 16px;
      margin: 0 10px 10px 10px;
    }

    .side-menu a:hover {
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 8px;
    }

    #sideMenu a#admin-panel-btn {
      font-weight: bold;
      color: #010002;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* Ø±Ø³Ù¾Ø§Ù†Ø³ÛŒÙˆ Ø¨Ø±Ø§ÛŒ ØªØ¨Ù„Øª */
    @media (max-width: 1024px) {
      #dashboard {
        padding: 15px 25px;
      }

      #dashboard .avatar img {
        width: 70px;
        height: 70px;
      }

      #dashboard h2 {
        font-size: 20px;
      }

      .btn {
        min-width: 110px;
        padding: 10px 14px;
      }

      #main {
        padding: 15px;
      }


    }

    /* Ø±Ø³Ù¾Ø§Ù†Ø³ÛŒÙˆ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
    @media (max-width: 768px) {
      #dashboard {
        padding: 12px 20px;
        min-height: 15vh;
      }

      #dashboard .avatar img {
        width: 60px;
        height: 60px;
      }

      #dashboard h2 {
        font-size: 18px;
      }

      #dashboard .username {
        font-size: 16px;
      }

      #dashboard .phone {
        font-size: 12px;
      }

      #logoutBtn.btn-logout {
        padding: 6px 12px;
        font-size: 10px;
        margin-left: 15px;
      }

      #main {
        padding: 10px;
      }

      #main h2 {
        font-size: 20px;
        margin-bottom: 15px;
      }

      .btn {
        min-width: 100px;
        padding: 8px 12px;
        font-size: 13px;
        margin: 5px;
      }

      .question {
        padding: 12px;
        margin: 10px 0;
      }

      input[type="number"] {
        width: 60px;
        padding: 8px;
        font-size: 14px;
      }

      #result {
        font-size: 16px;
        padding: 12px;
        margin-top: 15px;
      }

      .user-info .survey-end-date {
        font-size: 11px;

      }

      .user-info .survey-end-date .value {
        font-size: 12px;
      }


    }

    /* Ø±Ø³Ù¾Ø§Ù†Ø³ÛŒÙˆ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú© */
    @media (max-width: 480px) {
      #dashboard {
        padding: 10px 15px;
      }

      #dashboard h2 {
        font-size: 16px;
      }

      #dashboard .avatar img {
        width: 50px;
        height: 50px;
      }

      #dashboard .username {
        font-size: 12px;
      }

      #dashboard .phone {
        font-size: 11px;
      }

      #logoutBtn.btn-logout {
        padding: 5px 10px;
        font-size: 10px;
        margin-left: 10px;
      }

      .btn {
        min-width: 90px;
        padding: 6px 10px;
        font-size: 12px;
        margin: 3px;
      }

      #factory-container,
      #area-container {
        margin-bottom: 10px;
      }

      .question p {
        font-size: 14px;
      }

      input[type="number"] {
        width: 50px;
        padding: 6px;
        font-size: 13px;
      }


      .divider {
        width: 90%;
        margin: 15px auto;
      }

      /* Ø¨Ù‡Ø¨ÙˆØ¯ Ù†Ù…Ø§ÛŒØ´ Ø¬Ø¯ÙˆÙ„ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú© */
      table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }

      .user-info .survey-end-date {
        font-size: 10px;

      }

      .user-info .survey-end-date .value {
        font-size: 10px;
      }

      .score-btn {

        font-size: 10px;
      }


    }

    /* Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø³ÛŒØ§Ø± Ú©ÙˆÚ†Ú© (Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ) */
    @media (max-width: 360px) {
      #dashboard {
        padding: 8px 10px;
      }

      #dashboard h2 {
        font-size: 14px;
      }

      #dashboard .avatar img {
        width: 45px;
        height: 45px;
      }

      #dashboard .username {
        font-size: 11px;
      }

      #dashboard .phone {
        font-size: 9px;
      }

      #logoutBtn.btn-logout {
        padding: 4px 8px;
        font-size: 10px;
        margin-left: 8px;
      }

      .user-info .survey-end-date {
        font-size: 8px;

      }

      .user-info .survey-end-date .value {
        font-size: 8px;
      }

      .score-btn {

        font-size: 8px;
      }

    }
  </style>
</head>

<body>
  <!-- Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
  <div id="dashboard">
    <!--      <h2>Ú©Ø§Ø±Ø¨Ø±</h2>  -->
    <div class="avatar">
      <img src="./img/icon-150-150.png" alt="User Avatar">
    </div>
    <div class="user-info">
      <p class="username">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±</p>
      <p class="phone">Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„</p>
      <div id="survey-end-date" class="survey-end-date">
        <span class="value" id="TrikhArzyabiEnd-date">â€”</span>
        <span class="label">:ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒØ§Ù† Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ </span>

      </div>


    </div>

    <!-- Ø¯Ú©Ù…Ù‡ Ù‡Ù…Ø¨Ø±Ú¯Ø±ÛŒ -->
    <div id="menuButton" class="menu-btn">&#9776;</div>
    <!-- Ù…Ù†Ùˆ Ù‡Ù…Ø¨Ø±Ú¯Ø±ÛŒ -->
    <div id="sideMenu" class="side-menu">
      <P>__________</P>
      <a id="mainpage" href="5s_question.html">ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</a>
      <a id="gozaresh" href="personal_report.html">Ú¯Ø²Ø§Ø±Ø´ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ù…Ù†</a>
      <a id="logout" href="index.html">Ø®Ø±ÙˆØ¬</a>
    </div>

  </div>

  <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ -->
  <div id="main">
    <h2>Ø§Ù†ØªØ®Ø§Ø¨ ÙˆØ§Ø­Ø¯ Ø§ØµÙ„ÛŒ</h2>
    <div id="factory-container">
      <div class="loading" id="factoryLoading">
        <div class="loading-spinner"></div>
        <p>...Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙˆØ§Ø­Ø¯ Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ</p>
      </div>
    </div>
    <hr class="divider" id="factoryDivider" style="display:none;"> <!-- â¬…ï¸ Ø®Ø· Ø¬Ø¯Ø§Ú©Ù†Ù†Ø¯Ù‡ -->
    <div id="area-container"></div>
    <div id="questions-container"></div>
  </div>

  <div id="alertModal" class="modal">
    <div class="modal-content">
      <h3>ØªÙˆØ¬Ù‡</h3>
      <p id="modalMessage"></p>
      <button class="close-btn" onclick="closeModal()">Ø¨Ø§Ø´Ù‡</button>
    </div>
  </div>



  <script src="https://cdn.jsdelivr.net/npm/jalaali-js@1.1.0/dist/jalaali.min.js"></script>
  <script>
    // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³Ø±Ø§Ø³Ø±ÛŒ
    const sheetUrlQuestion = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRLQOZ1BULWMd-hYLNbp27FLhXSqic2zBD9Vw7w29BzzoTrwJliUAoRmVVKBWTdQq846up09UdiYLyc/pub?gid=0&single=true&output=csv";
    const sheetUrl_VisitingArea = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRLQOZ1BULWMd-hYLNbp27FLhXSqic2zBD9Vw7w29BzzoTrwJliUAoRmVVKBWTdQq846up09UdiYLyc/pub?gid=181820697&single=true&output=csv";

    let data = [];
    let selectedFactory = "";
    let selectedArea = "";
    let TarikhBazdid = "";
    let TrikhArzyabi = "";

    // Ø´ÛŒØ¡ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ú©Ø§Ø±Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ Ùˆ Ù†ÙˆØ§Ø­ÛŒ Ù…Ø¬Ø§Ø² Ø¯Ø± ØªØ§Ø±ÛŒØ® Ø¬Ø§Ø±ÛŒ
    let allowedFactoriesAndAreas = {
      factories: new Set(),
      areas: new Map() // Map<Ú©Ø§Ø±Ø®Ø§Ù†Ù‡, Set<Ù†Ø§Ø­ÛŒÙ‡>>
    };

    // ØªÙˆØ§Ø¨Ø¹ ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ®
    function toJalaali(gy, gm, gd) {
      const g_d_m = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];
      let gy2 = (gm > 2) ? (gy + 1) : gy;
      let days = 355666 + (365 * gy) + Math.floor((gy + 3) / 4)
        - Math.floor((gy + 99) / 100) + Math.floor((gy + 399) / 400)
        + gd + g_d_m[gm - 1];
      let jy = -1595 + 33 * Math.floor(days / 12053);
      days %= 12053;
      jy += 4 * Math.floor(days / 1461);
      days %= 1461;
      if (days > 365) {
        jy += Math.floor((days - 1) / 365);
        days = (days - 1) % 365;
      }
      const jm = (days < 186) ? 1 + Math.floor(days / 31)
        : 7 + Math.floor((days - 186) / 30);
      const jd = 1 + ((days < 186) ? (days % 31)
        : ((days - 186) % 30));
      return { jy, jm, jd };
    }

    function dateToNumber(str) {
      const [y, m, d] = str.split("/").map(Number);
      return y * 10000 + m * 100 + d;
    }

    // ØªØ¨Ø¯ÛŒÙ„ Ø¹Ø¯Ø¯ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ
    function toPersianDigits(str) {
      return str.toString().replace(/\d/g, d => "Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹"[d]);
    }

    // Ù†Ù…Ø§ÛŒØ´ Ù…Ø¯Ø§Ù„
    function showModal(message) {
      document.getElementById("modalMessage").textContent = message;
      document.getElementById("alertModal").style.display = "block";
    }

    function closeModal() {
      document.getElementById("alertModal").style.display = "none";
    }

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ùˆ ØªØ¹ÛŒÛŒÙ† Ú©Ø§Ø±Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ Ùˆ Ù†ÙˆØ§Ø­ÛŒ Ù…Ø¬Ø§Ø²
    async function loadData() {
      try {
        document.getElementById("factoryLoading").style.display = "block";

        // 1ï¸âƒ£ Ø®ÙˆØ§Ù†Ø¯Ù† Ø¢Ø®Ø±ÛŒÙ† Ø±Ø¯ÛŒÙ Ù¾Ø± Ø§Ø² Ø´ÛŒØª admin Ø¨Ø±Ø§ÛŒ ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§
        const resAdmin = await fetch(sheetUrl_VisitingArea);
        const textAdmin = await resAdmin.text();
        const delimiterAdmin = textAdmin.includes(";") ? ";" : ",";
        const rowsAdmin = textAdmin.trim().split("\n").filter(r => r.trim() !== "");

        // Ø¢Ø®Ø±ÛŒÙ† Ø±Ø¯ÛŒÙ Ù¾Ø± (Ø¨Ù‡ Ø¬Ø² Ù‡Ø¯Ø±)
        const lastRow = rowsAdmin[rowsAdmin.length - 1].split(delimiterAdmin).map(c => c.trim());

        // Ø³ØªÙˆÙ† A = ØªØ§Ø±ÛŒØ® Ø¨Ø§Ø²Ø¯ÛŒØ¯
        TarikhBazdid = lastRow[0] || "";
        // Ø³ØªÙˆÙ† B = ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒØ§Ù† Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ
        TrikhArzyabi = lastRow[1] || "";

        if (!TrikhArzyabi || !/^\d{4}\/\d{1,2}\/\d{1,2}$/.test(TrikhArzyabi)) {
          showModal("ØªØ§Ø±ÛŒØ® Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø±Ø§Ø³Øª. Ù„Ø·ÙØ§ Ø¨Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø¨Ú©Ù‡ Ø§Ø·Ù„Ø§Ø¹ Ø¯Ù‡ÛŒØ¯");
          document.getElementById("factoryLoading").style.display = "none";
          return;
        }

        // Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ
        let formattedTrikhArzyabi = TrikhArzyabi;
        const dateMatch = TrikhArzyabi.match(/^(\d{4})[\/\-\.](\d{1,2})[\/\-\.](\d{1,2})$/);
        if (dateMatch) {
          const year = dateMatch[1];
          const month = dateMatch[2].padStart(2, "0");
          const day = dateMatch[3].padStart(2, "0");
          formattedTrikhArzyabi = `${year}/${month}/${day}`;
        }

        const TrikhArzyabiElement = document.getElementById("TrikhArzyabiEnd-date");
        if (TrikhArzyabiElement) {
          TrikhArzyabiElement.textContent = toPersianDigits(formattedTrikhArzyabi);
        }

        // 2ï¸âƒ£ Ø®ÙˆØ§Ù†Ø¯Ù† Ú©Ù„ Ø´ÛŒØª visiting area Ø¨Ø±Ø§ÛŒ ØªØ¹ÛŒÛŒÙ† Ú©Ø§Ø±Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ Ùˆ Ù†ÙˆØ§Ø­ÛŒ Ù…Ø¬Ø§Ø²
        const dataVisiting = rowsAdmin.slice(1); // Ø­Ø°Ù Ù‡Ø¯Ø±
        const today = new Date();
        const jToday = toJalaali(today.getFullYear(), today.getMonth() + 1, today.getDate());
        const todayNum = jToday.jy * 10000 + jToday.jm * 100 + jToday.jd;
        const TrikhArzyabiNum = dateToNumber(TrikhArzyabi);

        // Ø¨Ø±Ø±Ø³ÛŒ Ø²Ù…Ø§Ù† Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ
        if (todayNum > TrikhArzyabiNum) {
          showModal("Ø²Ù…Ø§Ù† Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø± ØªØ§Ø±ÛŒØ® " + toPersianDigits(TrikhArzyabi) + " Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯Ù‡ Ø§Ø³Øª");
          document.getElementById("factoryLoading").style.display = "none";
          return;
        }

        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
        allowedFactoriesAndAreas.factories.clear();
        allowedFactoriesAndAreas.areas.clear();

        // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ visiting area
        dataVisiting.forEach(row => {
          const cells = row.split(delimiterAdmin).map(cell => cell.trim());
          if (cells.length >= 4) {
            const startDateStr = cells[0]; // ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹
            const endDateStr = cells[1];   // ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒØ§Ù†
            const factory = cells[2];      // Ú©Ø§Ø±Ø®Ø§Ù†Ù‡
            const area = cells[3];         // Ù†Ø§Ø­ÛŒÙ‡

            // ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ Ø¨Ù‡ Ø¹Ø¯Ø¯
            const startNum = dateToNumber(startDateStr);
            const endNum = dateToNumber(endDateStr);

            // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ø§Ù…Ø±ÙˆØ² Ø¯Ø± Ø¨Ø§Ø²Ù‡ Ø§Ø³Øª
            if (todayNum >= startNum && todayNum <= endNum) {
              // Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ Ø¨Ù‡ Ù„ÛŒØ³Øª Ù…Ø¬Ø§Ø²
              allowedFactoriesAndAreas.factories.add(factory);

              // Ø§ÙØ²ÙˆØ¯Ù† Ù†Ø§Ø­ÛŒÙ‡ Ø¨Ù‡ Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ Ù…Ø±Ø¨ÙˆØ·Ù‡
              if (!allowedFactoriesAndAreas.areas.has(factory)) {
                allowedFactoriesAndAreas.areas.set(factory, new Set());
              }
              allowedFactoriesAndAreas.areas.get(factory).add(area);
            }
          }
        });

        // 3ï¸âƒ£ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª
        const res = await fetch(sheetUrlQuestion);
        const text = await res.text();
        const delimiter = text.includes(";") ? ";" : ",";
        const rows = text.split("\n").slice(1);
        data = rows.map(r => r.split(delimiter).map(cell => cell.trim()));

        // 4ï¸âƒ£ Ø±Ù†Ø¯Ø± Ú©Ø§Ø±Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§
        renderFactories();

        document.getElementById("factoryLoading").style.display = "none";

      } catch (err) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± Ù„ÙˆØ¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§:", err);
        document.getElementById("factoryLoading").style.display = "none";
        showModal("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§. Ù„Ø·ÙØ§ Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.");
      }
    }

    // Ø±Ù†Ø¯Ø± Ú©Ø§Ø±Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù‚ÙÙ„ Ú©Ø±Ø¯Ù† Ù…ÙˆØ§Ø±Ø¯ ØºÛŒØ±Ù…Ø¬Ø§Ø²
    function renderFactories() {
      const container = document.getElementById("factory-container");
      document.getElementById("factoryLoading").style.display = "none";
      container.innerHTML = "";
      container.style.display = "flex";

      const factories = [...new Set(data.map(r => r[0]).filter(f => f))];

      factories.forEach(factory => {
        const btn = document.createElement("button");
        btn.className = "btn";
        btn.textContent = factory;

        // Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ Ø¯Ø± Ù„ÛŒØ³Øª Ù…Ø¬Ø§Ø² Ø§Ø³Øª
        if (allowedFactoriesAndAreas.factories.has(factory)) {
          // Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ Ù…Ø¬Ø§Ø² Ø§Ø³Øª - ÙØ¹Ø§Ù„
          btn.onclick = () => {
            selectedFactory = factory;
            highlightSelection(container, btn);
            renderAreas(factory);
          };
        } else {
          // Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ ØºÛŒØ±Ù…Ø¬Ø§Ø² - Ù‚ÙÙ„ Ø´Ø¯Ù‡
          btn.classList.add("locked");
          btn.disabled = true;
          btn.title = "Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ Ø§Ù…Ú©Ø§Ù† Ø§Ù…ØªÛŒØ§Ø² Ø¯Ù‡ÛŒ Ø¨Ù‡ Ø§ÛŒÙ† Ø¨Ø®Ø´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯";
        }

        container.appendChild(btn);
      });
    }

    // Ø±Ù†Ø¯Ø± Ù†ÙˆØ§Ø­ÛŒ Ø¨Ø§ Ù‚ÙÙ„ Ú©Ø±Ø¯Ù† Ù…ÙˆØ§Ø±Ø¯ ØºÛŒØ±Ù…Ø¬Ø§Ø²
    function renderAreas(factory) {
      document.getElementById("factoryDivider").style.display = "block";

      const container = document.getElementById("area-container");
      const qContainer = document.getElementById("questions-container");

      qContainer.innerHTML = "";
      container.innerHTML = "";
      container.style.display = "flex";

      const areas = [...new Set(data.filter(r => r[0] === factory).map(r => r[1]).filter(a => a))];

      // Ø¯Ø±ÛŒØ§ÙØª Ù†ÙˆØ§Ø­ÛŒ Ù…Ø¬Ø§Ø² Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ø§Ø±Ø®Ø§Ù†Ù‡
      const allowedAreasForFactory = allowedFactoriesAndAreas.areas.get(factory) || new Set();

      areas.forEach(area => {
        const btn = document.createElement("button");
        btn.className = "btn";
        btn.textContent = area;

        // Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ Ù†Ø§Ø­ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ Ù…Ø¬Ø§Ø² Ø§Ø³Øª
        if (allowedAreasForFactory.has(area)) {
          // Ù†Ø§Ø­ÛŒÙ‡ Ù…Ø¬Ø§Ø² Ø§Ø³Øª - ÙØ¹Ø§Ù„
          btn.onclick = () => {
            selectedArea = area;
            highlightSelection(container, btn);
            renderQuestions(factory, area);
          };
        } else {
          // Ù†Ø§Ø­ÛŒÙ‡ ØºÛŒØ±Ù…Ø¬Ø§Ø² - Ù‚ÙÙ„ Ø´Ø¯Ù‡
          btn.classList.add("locked");
          btn.disabled = true;
          btn.title = "Ø§ÛŒÙ† Ù†Ø§Ø­ÛŒÙ‡ Ø¯Ø± Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ Ø¬Ø§Ø±ÛŒ Ù…Ø¬Ø§Ø² Ù†ÛŒØ³Øª";
        }

        container.appendChild(btn);
      });
    }

    // Ø¨Ù‚ÛŒÙ‡ ØªÙˆØ§Ø¨Ø¹ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø¨Ø§Ù‚ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ù†Ø¯
    function renderQuestions(factory, area) {
      const container = document.getElementById("questions-container");
      container.innerHTML = `<h3>Ø³ÙˆØ§Ù„Ø§Øª ${area} - ${factory}</h3>`;

      const scoreLabels = ["Ø®ÛŒÙ„ÛŒ Ø¶Ø¹ÛŒÙ", "Ø¶Ø¹ÛŒÙ", "Ù…ØªÙˆØ³Ø·", "Ø®ÙˆØ¨", "Ø®ÛŒÙ„ÛŒ Ø®ÙˆØ¨", "Ø¹Ø§Ù„ÛŒ"];

      const questions = data.filter(r => r[0] === factory && r[1] === area);
      questions.forEach((row, index) => {
        const qDiv = document.createElement("div");
        qDiv.className = "question";
        qDiv.innerHTML = `
      <p>${row[4]} (ÙˆØ²Ù†: ${row[5]})</p>
      <div class="score-options"
        data-qno="${row[2]}"
        data-category="${row[3]}"
        data-question="${row[4]}"
        data-weight="${row[5]}"
        data-score="">
        ${scoreLabels.map((label, num) =>
          `<button type="button" class="score-btn" onclick="selectScore(this, ${num})">${label}</button>`
        ).join("")}
      </div>
      <textarea class="desc-box" placeholder="Ø§Ú¯Ø± Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙˆØ¶ÛŒØ­Ø§ØªÛŒ Ù‡Ø³Øª Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯"></textarea>
    `;
        container.appendChild(qDiv);
      });

      container.innerHTML += `
    <div id="result">Ø¬Ù…Ø¹ Ø§Ù…ØªÛŒØ§Ø² ÙˆØ§Ø­Ø¯: 0</div>
    <button class="btn" id="submitBtn" onclick="confirmSubmit()">Ø«Ø¨Øª Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ</button>
    <div class="loading" id="submitLoading" style="display:none;">
      <div class="loading-spinner"></div>
      <p>Ø¯Ø± Ø­Ø§Ù„ Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª...</p>
    </div>
    <div id="successMessage" style="display:none; background: var(--success2); color:white; padding:12px; margin-top:15px; border-radius:var(--border-radius); box-shadow:var(--box-shadow); text-align:center;">
      âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù†Ø¯
    </div>
  `;
    }

    function highlightSelection(container, activeBtn) {
      const buttons = container.querySelectorAll(".btn:not(.locked)");
      buttons.forEach(btn => {
        if (btn === activeBtn) {
          btn.classList.add("active");
          btn.classList.remove("disabled");
        } else {
          btn.classList.remove("active");
          btn.classList.add("disabled");
        }
      });
    }

    function selectScore(btn, score) {
      const parent = btn.parentElement;
      parent.dataset.score = score;
      parent.querySelectorAll(".score-btn").forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
      updateResult();
    }

    function updateResult() {
      const qDivs = document.querySelectorAll(".score-options");
      let total = 0;
      qDivs.forEach(div => {
        const val = parseFloat(div.dataset.score) || 0;
        const w = parseFloat(div.dataset.weight) || 1;
        total += (val * w) / 5;
      });
      document.getElementById("result").textContent = "Ø¬Ù…Ø¹ Ø§Ù…ØªÛŒØ§Ø²: %" + total.toFixed(2);
    }

    async function finalSubmit() {
      document.getElementById("submitLoading").style.display = "block";
      document.getElementById("submitBtn").style.display = "none";
      document.getElementById("successMessage").style.display = "none";

      const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxIVwdnM4Nf2I3jrHXa5zK1oH0GSRbuB7NS_PrbQhkEJwaf-J9meWSkXrtn6FNsuUBi/exec";
      const name = localStorage.getItem("name") || "Ù†Ø§Ù…";
      const family = localStorage.getItem("family") || "Ù†Ø§Ù…â€ŒØ®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ";
      const user = name + " " + family;

      let rows = [];

      const qDivs = document.querySelectorAll(".score-options");
      qDivs.forEach(div => {
        const descEl = div.parentElement.querySelector(".desc-box");
        const desc = descEl ? descEl.value.trim() : "";

        if (!TarikhBazdid) {
          showModal("ØªØ§Ø±ÛŒØ® Ø¨Ø§Ø²Ø¯ÛŒØ¯ Ù…Ø´Ø®Øµ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯.");
          document.getElementById("submitLoading").style.display = "none";
          document.getElementById("submitBtn").style.display = "block";
          return;
        }

        rows.push({
          tarikhBazdid: TarikhBazdid,
          user: user,
          factory: selectedFactory,
          area: selectedArea,
          qno: div.dataset.qno || "",
          category: div.dataset.category || "",
          question: div.dataset.question || "",
          weight: div.dataset.weight || "1",
          score: div.dataset.score || "0",
          description: desc,
        });
      });

      const params = new URLSearchParams();
      params.append('rows', JSON.stringify(rows));

      try {
        const res = await fetch(WEBAPP_URL, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: params.toString(),
          mode: "cors"
        });

        const text = await res.text();

        if (text.trim().toUpperCase() === "OK" || text.includes("success")) {
          document.getElementById("submitLoading").style.display = "none";
          document.getElementById("successMessage").style.display = "block";
          document.getElementById("questions-container").innerHTML = `
                <h3>Ø³ÙˆØ§Ù„Ø§Øª ${selectedArea} - ${selectedFactory}</h3>
                <div id="successMessage" style="background: var(--success2); color:white; padding:12px; margin-top:15px; border-radius:var(--border-radius); box-shadow:var(--box-shadow); text-align:center;">
                    âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù†Ø¯
                </div>
            `;
        } else {
          throw new Error("Ù¾Ø§Ø³Ø® Ù†Ø§Ù…Ø´Ø®Øµ Ø§Ø² Ø³Ø±ÙˆØ±: " + text);
        }
      } catch (err) {
        alert("Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±: " + err.message);
        document.getElementById("submitLoading").style.display = "none";
        document.getElementById("submitBtn").style.display = "block";
      }
    }

    function confirmSubmit() {
      const isConfirmed = confirm("Ø¢ÛŒØ§ Ø§Ø² Ø«Ø¨Øª Ø§Ù…ØªÛŒØ§Ø²Ø§Øª Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ");
      if (isConfirmed) {
        finalSubmit();
      }
    }

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
    document.addEventListener("DOMContentLoaded", () => {
      loadData();
    });


    // Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js')
        .then(() => console.log('Service Worker Ø«Ø¨Øª Ø´Ø¯'))
        .catch(err => console.error('Ø«Ø¨Øª Service Worker Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯:', err));
    }

    // Ù…Ù†ÙˆÛŒ Ù‡Ù…Ø¨Ø±Ú¯Ø±ÛŒ
    const menuButton = document.getElementById("menuButton");
    const sideMenu = document.getElementById("sideMenu");

    menuButton.addEventListener("click", (event) => {
      event.stopPropagation(); // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ù†ØªØ´Ø§Ø± Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ù‡ Ø³Ù†Ø¯
      if (sideMenu.style.width === "250px") {
        sideMenu.style.width = "0";
      } else {
        sideMenu.style.width = "250px";
      }
    });

    // Ø¨Ø³ØªÙ† Ù…Ù†Ùˆ Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø®Ø§Ø±Ø¬ Ø§Ø² Ø¢Ù†
    document.addEventListener("click", (event) => {
      // Ø§Ú¯Ø± Ù…Ù†Ùˆ Ø¨Ø§Ø² Ø§Ø³Øª Ùˆ Ú©Ù„ÛŒÚ© Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ù†Ùˆ Ùˆ Ø®Ø§Ø±Ø¬ Ø§Ø² Ø¯Ú©Ù…Ù‡ Ù‡Ù…Ø¨Ø±Ú¯Ø±ÛŒ Ø¨Ø§Ø´Ø¯
      if (sideMenu.style.width === "250px" &&
        !sideMenu.contains(event.target) &&
        !menuButton.contains(event.target)) {
        sideMenu.style.width = "0";
      }
    });

    // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù† Ù…Ù†Ùˆ Ù‡Ù†Ú¯Ø§Ù… Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø®ÙˆØ¯ Ù…Ù†Ùˆ
    sideMenu.addEventListener("click", (event) => {
      event.stopPropagation();
    });

    // ØªÙ†Ø¸ÛŒÙ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ†
    document.addEventListener("DOMContentLoaded", () => {
      const name = localStorage.getItem("name") || "Ù†Ø§Ù…";
      const family = localStorage.getItem("family") || "Ù†Ø§Ù…â€ŒØ®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ";
      const phone = localStorage.getItem("phone") || "Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„";

      document.querySelector("#dashboard .username").textContent =
        name + " " + family + " Ø¹Ø²ÛŒØ² Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ ";
      document.querySelector("#dashboard .phone").textContent =
        "Ø§Ø² Ø§ÛŒÙ† Ú©Ù‡ Ø¯Ø± Ø¨Ø§Ù„Ø§ Ø¨Ø±Ø¯Ù† Ú©ÛŒÙÛŒØª Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù…Ø¬ØªÙ…Ø¹ ÙÙˆÙ„Ø§Ø¯ Ø±ÙˆÙ‡ÛŒÙ†Ø§ Ù…Ø´Ø§Ø±Ú©Øª Ù…ÛŒ Ú©Ù†ÛŒØ¯ Ø¨ÛŒ Ù†Ù‡Ø§ÛŒØª Ø³Ù¾Ø§Ø³Ú¯Ø°Ø§Ø±ÛŒÙ…";

      const role = localStorage.getItem("access");
      if (role && role.toUpperCase() === "ADMIN") {
        const sideMenu = document.getElementById("sideMenu");
        const adminBtn = document.createElement("a");
        adminBtn.href = "adminstration.html";
        adminBtn.textContent = "Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØª";
        adminBtn.id = "admin-panel-btn";
        const logoutBtn = document.getElementById("logout");
        sideMenu.insertBefore(adminBtn, logoutBtn);
      }
    });
  </script>
</body>

</html>